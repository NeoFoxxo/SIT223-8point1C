pipeline {
    agent any
    stages {
      stage("Build") {
        steps {
            echo "Fetch the source code from the repository "
            echo "Build and package the Node.JS application with NPM "
        }
      }
      stage("Unit and Integration tests") {
        steps {
            echo "Running the unit tests created with Jest"
            echo "Running Integration tests created with Supertest"
        }
        post {
          success {
            mail to: "private8981@gmail.com",
            subject: "Test pipeline results",
            body: "The unit and integration tests were successful!"
          }
          failure {
            mail to: "private8981@gmail.com",
            subject: "Test pipeline results",
            body: "The unit and integration tests have failed!"
          }
        }
      }
      stage("Code Analysis") {
        steps {
            echo "Running SonarQube to check the quality of the code and to ensure it meets industry standards"
        }
      }
      stage("Security Scan") {
        steps {
            echo "Running Snyk to analyse the code for any security vulnerabilities"
        }
        post {
          success {
            mail to: "private8981@gmail.com",
            subject: "Security Scan pipeline results",
            body: "The security scan was successful!"
          }
          failure {
            mail to: "private8981@gmail.com",
            subject: "Security Scan pipeline results",
            body: "The security scan failed!"
          }
        }
      }
      stage("Deploy To Staging") {
        steps {
            echo "Deploying the application to the staging EC2 instance"
        }
      }
      stage("Staging integration tests") {
        steps {
            echo "Running the integration test suite on the staging environment"
        }
      }
      stage("Deploy to production") {
        steps {
            echo "Deploying the application to the production EC2 server instance"
        }
      }
    }
}